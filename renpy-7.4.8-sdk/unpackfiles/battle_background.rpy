
## BATTLE BUTTONS
#
image party_section_button_selected_idle = "battle/ui/party_section_button_selected_idle.png"
image party_section_button_idle = "battle/ui/party_section_button_idle.png"
image party_section_button_hover = "battle/ui/party_section_button_hover.png"
image party_section_button_insensitive:
    "battle/ui/party_section_button_idle.png"
    alpha 0.2
    
image attack_main_button_insensitive:
    "battle/ui/attack_main_button_idle.png"
    alpha 0.2
    
image attack_button_insensitive:
    "battle/ui/attack_button_idle.png"
    alpha 0.2
    
image party_choose_button_idle = "battle/ui/party_choose_button_idle.png"
image party_choose_button_hover = "battle/ui/party_choose_button_hover.png"
image party_choose_button_insensitive = im.MatrixColor("battle/ui/party_choose_button_idle.png", im.matrix.opacity(0.5))
    
image party_cancel_button_idle = "battle/ui/party_cancel_button_idle.png"
image party_cancel_button_hover = "battle/ui/party_cancel_button_hover.png"
image party_cancel_button_insensitive:
    "battle/ui/party_cancel_button_idle.png"
    alpha 0.5
    
image party_member_display = "battle/ui/party_member_display.png"
image party_member_display_hover = "battle/ui/party_member_display_hover.png"
image party_member_display_selected_idle:
    "battle/ui/party_member_display.png"
    alpha 0.4
    
image battlestats_power_selected_idle = "battle/ui/battlestats_power_selected_idle.png"
image battlestats_power_idle = "battle/ui/battlestats_power_idle.png"
image battlestats_power_hover = "battle/ui/battlestats_power_hover.png"
image battlestats_power_insensitive:
    "battle/ui/battlestats_power_idle.png"
    alpha 0.2
    
image battlestats_armor_selected_idle = "battle/ui/battlestats_armor_selected_idle.png"
image battlestats_armor_idle = "battle/ui/battlestats_armor_idle.png"
image battlestats_armor_hover = "battle/ui/battlestats_armor_hover.png"
image battlestats_armor_insensitive:
    "battle/ui/battlestats_armor_idle.png"
    alpha 0.2
    
image battlestats_accuracy_selected_idle = "battle/ui/battlestats_accuracy_selected_idle.png"
image battlestats_accuracy_idle = "battle/ui/battlestats_accuracy_idle.png"
image battlestats_accuracy_hover = "battle/ui/battlestats_accuracy_hover.png"
image battlestats_accuracy_insensitive:
    "battle/ui/battlestats_accuracy_idle.png"
    alpha 0.2
    
image battlestats_charm_selected_idle = "battle/ui/battlestats_charm_selected_idle.png"
image battlestats_charm_idle = "battle/ui/battlestats_charm_idle.png"
image battlestats_charm_hover = "battle/ui/battlestats_charm_hover.png"
image battlestats_charm_insensitive:
    "battle/ui/battlestats_charm_idle.png"
    alpha 0.2
    
image battlestats_speed_selected_idle = "battle/ui/battlestats_speed_selected_idle.png"
image battlestats_speed_idle = "battle/ui/battlestats_speed_idle.png"
image battlestats_speed_hover = "battle/ui/battlestats_speed_hover.png"
image battlestats_speed_insensitive:
    "battle/ui/battlestats_speed_idle.png"
    alpha 0.2

image battleicon_power = "battle/ui/battleicon_power.png"
image battleicon_armor = "battle/ui/battleicon_armor.png"
image battleicon_accuracy = "battle/ui/battleicon_accuracy.png"
image battleicon_charm = "battle/ui/battleicon_charm.png"
image battleicon_speed = "battle/ui/battleicon_speed.png"

image readyfight_text_getready = "battle/ui/readyfight_text_getready.png"
image readyfight_text_fight = "battle/ui/readyfight_text_fight.png"
image readyfight_text_damage = "battle/ui/readyfight_text_damage.png"
image readyfight_text_miss = "battle/ui/readyfight_text_miss.png"
image readyfight_text_knockout = "battle/ui/readyfight_text_knockout.png"
    
image yesno_no_small_idle = "battle/ui/yesno_no_small_idle.png"
image yesno_no_small_hover = "battle/ui/yesno_no_small_hover.png"
image yesno_no_small_insensitive = im.MatrixColor("battle/ui/yesno_no_small_idle.png", im.matrix.opacity(0.3))
image yesno_no_small_faded = im.MatrixColor("battle/ui/yesno_no_small_idle.png", im.matrix.opacity(0.5))

image yesno_no_idle = "battle/ui/yesno_no_idle.png"
image yesno_no_hover = "battle/ui/yesno_no_hover.png"
image yesno_no_insensitive = im.MatrixColor("battle/ui/yesno_no_idle.png", im.matrix.opacity(0.3))
image yesno_no_faded = im.MatrixColor("battle/ui/yesno_no_idle.png", im.matrix.opacity(0.5))

image empty_card_faded = im.MatrixColor("battle/ui/empty_card2.png", im.matrix.opacity(0.6))
image yesno_info_small_faded = im.MatrixColor("battle/ui/yesno_info_small_idle.png", im.matrix.opacity(0.5))
image yesno_add_small_faded = im.MatrixColor("battle/ui/yesno_add_small_idle.png", im.matrix.opacity(0.5))

image empty_card_insensitive = im.MatrixColor("battle/ui/empty_card2.png", im.matrix.opacity(0.3))
image yesno_info_small_insensitive = im.MatrixColor("battle/ui/yesno_info_small_idle.png", im.matrix.opacity(0.3))
image yesno_add_small_insensitive = im.MatrixColor("battle/ui/yesno_add_small_idle.png", im.matrix.opacity(0.3))

image basic_infantry_profile = "battle/gfx/basic_infantry_profile.png"
image basic_infantry_profile_insensitive = im.MatrixColor("battle/gfx/basic_infantry_profile.png", im.matrix.opacity(0.3))
image basic_panzer_profile = "battle/gfx/basic_panzer_profile.png"
image basic_panzer_profile_insensitive = im.MatrixColor("battle/gfx/basic_panzer_profile.png", im.matrix.opacity(0.3))
image basic_antitank_profile = "battle/gfx/basic_antitank_profile.png"
image basic_antitank_profile_insensitive = im.MatrixColor("battle/gfx/basic_antitank_profile.png", im.matrix.opacity(0.3))
image basic_commander_profile = "battle/gfx/basic_commander_profile.png"
image basic_commander_profile_insensitive = im.MatrixColor("battle/gfx/basic_commander_profile.png", im.matrix.opacity(0.3))
image basic_airsupport_profile = "battle/gfx/basic_airsupport_profile.png"
image basic_airsupport_profile_insensitive = im.MatrixColor("battle/gfx/basic_airsupport_profile.png", im.matrix.opacity(0.3))
image basic_specialgroup_profile = "battle/gfx/basic_specialgroup_profile.png"
image basic_specialgroup_profile_insensitive = im.MatrixColor("battle/gfx/basic_specialgroup_profile.png", im.matrix.opacity(0.3))

#

## BACKGROUNDS
#
image background_beach:
    parallel:
        contains:
            "battle/gfx/background_beach.jpg"
        contains:
            StarField().sm
            
image background_bunker:
    parallel:
        contains:
            "battle/gfx/background_bunker.jpg"
        contains:
            StarField().sm
            
image background_churchill:
    parallel:
        contains:
            "battle/gfx/background_churchill.jpg"
        contains:
            StarField().sm
            
image background_cyrano:
    parallel:
        contains:
            "battle/gfx/background_cyrano.jpg"
        contains:
            StarField().sm
            
image background_dark:
    parallel:
        contains:
            "battle/gfx/background_dark.jpg"
        contains:
            StarField().sm
            
image background_desert:
    parallel:
        contains:
            "battle/gfx/background_desert.jpg"
        contains:
            StarField().sm
            
image background_field:
    parallel:
        contains:
            "battle/gfx/background_field.jpg"
        contains:
            StarField().sm
            
image background_forest:
    parallel:
        contains:
            "battle/gfx/background_forest.jpg"
        contains:
            StarField().sm
            
image background_grass:
    parallel:
        contains:
            "battle/gfx/background_grass.jpg"
        contains:
            StarField().sm
            
image background_sea:
    parallel:
        contains:
            "battle/gfx/background_sea.jpg"
        contains:
            StarField().sm
            
image background_sky:
    parallel:
        contains:
            "battle/gfx/background_sky.jpg"
        contains:
            StarField().sm
            
image background_snow:
    parallel:
        contains:
            "battle/gfx/background_snow.jpg"
        contains:
            StarField().sm
            
image background_town:
    parallel:
        contains:
            "battle/gfx/background_town.jpg"
        contains:
            StarField().sm
            
image background_tunnel:
    parallel:
        contains:
            "battle/gfx/background_tunnel.jpg"
        contains:
            StarField().sm
            
image background_urban:
    parallel:
        contains:
            "battle/gfx/background_urban.jpg"
        contains:
            StarField().sm
            
#

## PLATES
#
image plate_beach = "battle/gfx/plate_beach.png"
image plate_brick = "battle/gfx/plate_brick.png"
image plate_churchill = "battle/gfx/plate_churchill.png"
image plate_desert = "battle/gfx/plate_desert.png"
image plate_deserturban = "battle/gfx/plate_deserturban.png"
image plate_dirt = "battle/gfx/plate_dirt.png"
image plate_field = "battle/gfx/plate_field.png"
image plate_grass = "battle/gfx/plate_grass.png"
image plate_indoors = "battle/gfx/plate_indoors.png"
image plate_metal = "battle/gfx/plate_metal.png"
image plate_none = Null()
image plate_rail = "battle/gfx/plate_rail.png"
image plate_river = "battle/gfx/plate_river.png"
image plate_snow = "battle/gfx/plate_snow.png"
image plate_port = "battle/gfx/plate_port.png"
image plate_urban = "battle/gfx/plate_urban.png"
#

## DECORATIONS

# None Decorations
image decoration_none_front1 = Null()
image decoration_none_back1 = Null()

# Jungle Decorations
image decoration_jungle_front1 = "battle/gfx/decoration_jungle_front1.png"
image decoration_jungle_back1 = "battle/gfx/decoration_jungle_back1.png"

# Beach/Sea Decorations
image decoration_beach_front1 = "battle/gfx/decoration_beach_front1.png"
image decoration_beach_back1 = "battle/gfx/decoration_beach_back1.png"

# Desert Decorations
image decoration_desert_front1 = "battle/gfx/decoration_desert_front1.png"
image decoration_desert_back1 = "battle/gfx/decoration_desert_back1.png"
image decoration_desert_front2 = "battle/gfx/decoration_desert_front2.png"
image decoration_desert_back2 = "battle/gfx/decoration_desert_back2.png"
image decoration_desert_front3 = "battle/gfx/decoration_desert_front3.png"
image decoration_desert_back3 = "battle/gfx/decoration_desert_back3.png"

# Grassland/Forest Decorations
image decoration_grass_front1 = "battle/gfx/decoration_grass_front1.png"
image decoration_grass_back1 = "battle/gfx/decoration_grass_back1.png"
image decoration_grass_front2 = "battle/gfx/decoration_grass_front2.png"
image decoration_grass_back2 = "battle/gfx/decoration_grass_back2.png"
image decoration_grass_front3 = "battle/gfx/decoration_grass_front3.png"
image decoration_grass_back3 = "battle/gfx/decoration_grass_back3.png"
image decoration_farm_front1 = "battle/gfx/decoration_farm_front1.png"
image decoration_farm_back1 = "battle/gfx/decoration_farm_back1.png"
image decoration_forest_front1 = "battle/gfx/decoration_forest_front1.png"
image decoration_forest_back1 = "battle/gfx/decoration_forest_back1.png"
image decoration_forest_front2 = "battle/gfx/decoration_forest_front2.png"

# Railway/Depot Decorations
image decoration_rail_front1 = "battle/gfx/decoration_rail_front1.png"
image decoration_rail_back1 = "battle/gfx/decoration_rail_back1.png"
image decoration_rail_front2 = "battle/gfx/decoration_rail_front2.png"
image decoration_rail_back2 = "battle/gfx/decoration_rail_back2.png"

# Snow/Mountain Decorations
image decoration_snow_front1 = "battle/gfx/decoration_snow_front1.png"
image decoration_snow_back1 = "battle/gfx/decoration_snow_back1.png"
image decoration_snow_front2 = "battle/gfx/decoration_snow_front2.png"
image decoration_snow_back2 = "battle/gfx/decoration_snow_back2.png"
image decoration_snow_front3 = "battle/gfx/decoration_snow_front3.png"
image decoration_snow_back3 = "battle/gfx/decoration_snow_back3.png"

# Urban/City Decorations
image decoration_urban_front1 = "battle/gfx/decoration_urban_front1.png"
image decoration_urban_back1 = "battle/gfx/decoration_urban_back1.png"
image decoration_urban_front2 = "battle/gfx/decoration_urban_front2.png"
image decoration_urban_back2 = "battle/gfx/decoration_urban_back2.png"
image decoration_urban_front3 = "battle/gfx/decoration_urban_front3.png"
image decoration_urban_back3 = "battle/gfx/decoration_urban_back3.png"

# Cave Decorations
image decoration_cave_front1 = "battle/gfx/decoration_cave_front1.png"
image decoration_cave_back1 = "battle/gfx/decoration_cave_back1.png"

# Mansion Decorations
image decoration_mansion_front1 = "battle/gfx/decoration_mansion_front1.png"
image decoration_mansion_back1 = "battle/gfx/decoration_mansion_back1.png"

# Ship Decorations
image decoration_ship_front1 = "battle/gfx/decoration_ship_front1.png"
image decoration_ship_back1 = "battle/gfx/decoration_ship_back1.png"

# Sky Decorations
image decoration_sky_front1 = "battle/gfx/decoration_sky_front1.png"
image decoration_sky_back1 = "battle/gfx/decoration_sky_back1.png"

# Specific Location Decorations
image decoration_altberlin_front1 = "battle/gfx/decoration_altberlin_front1.png"
image decoration_altberlin_back1 = "battle/gfx/decoration_altberlin_back1.png"
image decoration_albion_front1 = "battle/gfx/decoration_albion_front1.png"
image decoration_albion_back1 = "battle/gfx/decoration_albion_back1.png"
image decoration_clocktower_front1 = "battle/gfx/decoration_clocktower_front1.png"
image decoration_clocktower_back1 = "battle/gfx/decoration_clocktower_back1.png"
image decoration_grecia_front1 = "battle/gfx/decoration_grecia_front1.png"
image decoration_grecia_back1 = "battle/gfx/decoration_grecia_back1.png"
image decoration_lutetia_front1 = "battle/gfx/decoration_lutetia_front1.png"
image decoration_lutetia_back1 = "battle/gfx/decoration_lutetia_back1.png"
image decoration_lutetia_front2 = "battle/gfx/decoration_lutetia_front2.png"
image decoration_starinbase_front1 = "battle/gfx/decoration_starinbase_front1.png"
image decoration_starinbase_back1 = "battle/gfx/decoration_starinbase_back1.png"
image decoration_rubble_front1 = "battle/gfx/decoration_rubble_front1.png"
image decoration_rubble_back1 = "battle/gfx/decoration_rubble_back1.png"
image decoration_zhina_front1 = "battle/gfx/decoration_zhina_front1.png"
image decoration_zhina_back1 = "battle/gfx/decoration_zhina_back1.png"
image decoration_zhinatemple_front1 = "battle/gfx/decoration_zhinatemple_front1.png"
image decoration_zhinatemple_back1 = "battle/gfx/decoration_zhinatemple_back1.png"

## CGs
    
image cg_thousandyearstrike:
    "cg/cg_hitora1_3.jpg"
    xalign 0.5
    yalign 1.0
    linear 2.4 yalign 0.3
    
image cg_cyberstrike:
    "cg/cg_negahitora.jpg"
    xalign 0.5
    yalign 1.0
    linear 2.4 yalign 0.3
    
image cg_summerdance:
    contains:
        im.MatrixColor("battle/skills/fireworks1.png", im.matrix.brightness(0.8) * im.matrix.tint(1.0, 0.2, 0.2))
        zoom 0 xalign 0.8 yalign 0.7
        pause 0.3
        linear 1.0 zoom 0.7
        repeat
    contains:
        im.MatrixColor("battle/skills/fireworks1.png", im.matrix.brightness(0.8) * im.matrix.tint(0.2, 1.0, 0.2))
        zoom 0 xalign 0.3 yalign 0.3
        pause 0.5
        linear 1.0 zoom 0.4
        repeat
    contains:
        im.MatrixColor("battle/skills/fireworks1.png", im.matrix.brightness(0.8) * im.matrix.tint(0.2, 0.2, 1.0))
        zoom 0 xalign 0.5 yalign 0.5
        pause 0.9
        linear 1.0 zoom 0.6
        repeat
    contains:
        im.MatrixColor("battle/skills/fireworks1.png", im.matrix.brightness(0.8) * im.matrix.tint(1.0, 0.2, 1.0))
        zoom 0 xalign 0.7 yalign 0.3
        pause 0.2
        linear 1.0 zoom 0.4
        repeat
    contains:
        im.MatrixColor("battle/skills/fireworks1.png", im.matrix.brightness(0.8) * im.matrix.tint(0.2, 1.0, 1.0))
        zoom 0 xalign 0.1 yalign 0.7
        pause 0.6
        linear 1.0 zoom 0.9
        repeat
    
    
image cg_samurai:
    "battle/skills/samurai.png"
    xalign 0.5 yalign 0.5 zoom 0.5
    linear 2.0 zoom 2.0
    
image cg_bushido:
    "battle/skills/bushido.png"
    xalign 0.5 yalign 0.5 zoom 2.0
    linear 2.0 zoom 0.5
    
image cg_storm:
    contains:
        "back/effects/storm1.png"
        pause 0.1
        "back/effects/storm2.png"
        pause 0.1
        repeat

init python:
        
    import random

    def grint(ya, yb, n):
        res = n + 1
        r = [[] for index in range(res)]
        initial_list = ya
        final_list = yb
        for col in range(len(ya)):
            for i in range(res):
                r[i].append((i * (yb[col] - ya[col]) / n) + ya[col])
        for item in range(res):
            r[item] = tuple(r[item])
        return r

    # Create a new class that is a subclass of renpy.Displayable.
    class Blockfield(renpy.Displayable):


        # Let's pass it some dimensional information in the constructor so it knows how big of a view we want...
        # We can also pass on a kwarg telling it how many parallax layers to construct.  Too big numbers will have
        # strange effects...
        def __init__(self, x, y, layers=2, **kwargs):

            super(Blockfield, self).__init__(**kwargs)

            # My personal preference is to overscan the field, but you can choose not to- it's not very efficient.
            self.width = x + 100
            self.height = y + 100
            self.num = int((x * y) / 400000000) # I like setting the number of stars this way
                                           # so there is always a constant ratio of stars
                                           # on the screen no matter how large a field we
                                           # define.  A smaller constant produces more
                                           # stars.  A constant of 1 will create a star for
                                           # every pixel in the x by y area.
            self.layers = layers

            # Use our group interpolation function, grint(), to create different colors for stars.
            # From darkest/farthest, to lightest/closest, one (r, g, b, a) value for each layer.
            # Obviously, you can also set a gradient manually, just supply a list containing
            # (r, g, b, a) tuples.
            self.gradient = grint([255, 255, 255, 200], [255, 255, 255, 255], self.layers)
            
            

            # Now we'll call the method that builds our list of stars.  As many as we need to satisfy self.num.
            self.stars = self.init_stars(self.num)


        def init_stars(self, num):

            nos = num

            stars = []

            for item in range(nos):
                xpos = random.randint(0, self.width)   # Assign it to a random point on the screen.
                ypos = random.randint(0, self.height)  #
                layer = random.randint(0, self.layers) # Assign it to a random layer.
                stars.append([xpos, ypos, layer])      # Append it to our list of stars.

            return stars


        # We override this method from renpy.Displayable and use it to draw our stuff...
        def render(self, width, height, st, at):

            w, h = (self.width, self.height)

            # Let's create the render that this class must return, as well as a canvas we'll use to draw
            # our stars.  canvas() gives us access to all the pygame.draw methods.
            render = renpy.Render(width, height)
            draw = render.canvas()

            # We're going to separate stars into groups based on what layer they're in, so we can control the
            # draw order and make sure far away stars aren't drawn on top of closer stars.
            stargroups = [[] for index in range(self.layers + 1)]

            for star in self.stars:
                stargroups[star[2]].append(star)

            # Now we'll iterate over our list of stars and draw each one based on its attributes.  The
            # "farthest" group gets drawn first.  Subsequent groups are drawn on top of the preceding groups.
            for group in stargroups:
                for star in group:

                    # It's not very efficient to assign this many variables every frame, but it's for readability.
                    xpos = star[0]
                    ypos = star[1]
                    layer = star[2]
                    speed = ((layer + 5) ** 2) / 1.0
                    thickness = (layer + 15) # Don't want the lines to be too thin...
                    if thickness > 15:       # Or too thick...
                        thickness = 15
                    color = self.gradient[layer] # Choose a color based on the star's layer property.
                    length = xpos + ((layer + 12) ** 2) # Closer/Faster stars should be longer.

                    # Draw the star to the canvas.
                    draw.line(color, (xpos, ypos), (length, ypos), thickness)

                    # Move the star at the appropriate speed (close->fast) so it's in a new position before we
                    # draw it again in the next frame.
                    star[0] -= speed

                    # If the star moves far enough off the left side of the screen, respawn it
                    # on the right side.
                    if star[0] < -200:
                        star[0] = w
                        star[1] = random.randint(0, h)

            # We've positioned all of our stars this frame, so now we tell RenPy to draw the frame.
            renpy.redraw(self, 0)

            # Pass the render object off to RenPy to do whatever it
            # does with it (position it on screen, presumably).
            return render

    class StarField(object):

        def __init__(self):

            self.sm = SpriteManager(update=self.update)

            # A list of (sprite, starting-x, speed).
            self.stars = [ ]

            # Note: We store the displayable in a variable here.
            # That's important - it means that all of the stars at
            # a given speed have the same displayable. We render that
            # displayable once, and cache the result.

            d = Transform("battle/gfx/parallax_scroller.png", zoom=0.2)
            for i in range(0, 15):
                self.add(d, 20)

            d = Transform("battle/gfx/parallax_scroller.png", zoom=0.25)
            for i in range(0, 15):
                self.add(d, 80)

            d = Transform("battle/gfx/parallax_scroller.png", zoom=0.5)
            for i in range(0, 10):
                self.add(d, 160)

            d = Transform("battle/gfx/parallax_scroller.png", zoom=0.75)
            for i in range(0, 10):
                self.add(d, 320)

            d = Transform("battle/gfx/parallax_scroller.png", zoom=1)
            for i in range(0, 5):
                self.add(d, 640)

            d = Transform("battle/gfx/parallax_scroller.png", zoom=1.25)
            for i in range(0, 5):
                self.add(d, 1280)

        def add(self, d, speed):
            s = self.sm.create(d)

            start = renpy.random.randint(0, 1920)
            s.y = renpy.random.randint(0, 800)

            self.stars.append((s, start, speed))

        def update(self, st):
            for s, start, speed in self.stars:
                s.x = (start + speed * st) % 1920 - 20

            return 0

